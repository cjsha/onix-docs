#################
RHS2116 Headstage
#################

The RHS2116 Headstage is a serialized headstage for small animals with 32 channels which can independently be configured as stimulator outputs or amplifier inputs. The RHS2116 can be used with passive probes (e.g. silicon arrays, EEG/ECOG arrays, etc) using a 36-Channel Omnetics Adapter or similar 

.. image:: /_static/images/rhs2116/rhs2116.png
    :align: center
    :height: 400px
    :alt: ONIX rhs2116

.. warning:: There are multiple headstage hardware revisions. The revision number is printed on the PCB. You can use the `compatibility matrix <https://docs.google.com/spreadsheets/d/1LwEOlOkL_HJKeTmNJFVIlItzVeCZDzOt_9Up_rA36Ic/edit?usp=sharing>`__ to find host hardware for your headstage.

********
Features
********

*   Two RHS2116 ICs for a combined 32 reconfigurable i/o ephys channels

*   Stimulator max current: 2.55mA

*   30193.236714975847 sample rate

*   Stimulus active and stimulus trigger pins

*   On-board Lattice Crosslinkâ„¢ FPGA for real-time data arbitration

***********************
Data Link Serialization
***********************

For details on data serialization and headstage gateware, have a look at the
:ref:`serialization` page, which describes how coax headstages operate in
general terms. The RHS2116 headstage has the following coaxial link properties:

.. table::
    :widths: 50 80 50 50 50

    +------------------------+--------------------+----------+----------+----------+
    | Parameter              | Value              | Min      | Max      | Unit/    |
    |                        |                    |          |          | Type     |
    +========================+====================+==========+==========+==========+
    | FPGA                   | LIF-MD6000-6UMG64I |          |          |          |
    +------------------------+--------------------+----------+----------+----------+
    | Serializer             | TI DS90UB933       |          |          | Coaxial  |
    +------------------------+--------------------+----------+----------+----------+
    | Supply Voltage         | 4.0                | 3.4      | 4.35*    | Volts    |
    +------------------------+--------------------+----------+----------+----------+
    | Hub Clock Frequency    | 50                 |          |          | MHz      |
    +------------------------+--------------------+----------+----------+----------+

.. warning:: \*Do not exceed 4.35 VDC at the coaxial input to the headstage. Make
    sure you make this measurement at the headstage (see :ref:`measure_voltage`) to
    account for a potential voltage drop in the tether. Exceeding this voltage can
    permanently damage the headstage.

.. note:: Have a look at the :ref:`tethers` page for more details on micro-coax headstage tethers

*****************
Electrophysiology
*****************

RHS2116 headstage uses two 16-channel, BGA-packaged `Intan RHS2116
<https://intantech.com/>`_ bioamplifier chip. The chip is operated at a fixed
sampling rate of 30 kHz/channel. The RHS2116 provides 32 ephys channels which are exposed via a 36 pin `Omnetics connector <https://www.omnetics.com/wp-content/uploads/2022/01/A79025-001.pdf>`__ on the bottom of the headstage and can be used to record from most passive probes (e.g. 
tetrodes, silicon probe arrays, tungsten microwires, steel EEG wires, etc.)

The pinout of the RHS2116 is as follows:

..  image:: /_static/images/rhs2116/rhs2116-omnetics.webp
    :align: center
    :height: 400px
    :alt: ONIX rhs2116 omnetics

..  todo::
    We still have to photoshop this image, but I want to make sure that this is the way we want to map the channels 0->32 (ignoring GNDs and refs):

    15<-----------------------------------------------0

    16----------------------------------------------->31

    (IS THIS TRUE?)

Stimulation
===========

Stimulus trains can be parameterized in a similar way to the master-8 or pulse pal. (IS THIS TRUE?)

The stimulator can supply up to +/- 2.55 mA. The compliance voltage is 10V (IS THIS TRUE?)

*****************
Bill of Materials
*****************

- `Interactive BOM <../../_static/boms/headstage-rhs2116_bom.html>`__
- `Downloadable CSV BOM <https://github.com/open-ephys/onix-headstage-rhs2116/blob/main/pcb/manufacturing/bom/headstage-rhs2116.csv>`__

.. note:: Have a look at the :ref:`tether_voltage` page for more details on probing and verifying headstage power voltages 